<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>LYN AutoSales — Evaluador</title>
  <link rel="apple-touch-icon" href="/assets/logo-lyn.png">
  <!-- CSS mínimo de respaldo -->
  <style>
    body {background:#0b0f14;color:#e9f1f7;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .view{display:none}.view.active{display:block}
  </style>
  <!-- CSS externo con cache-buster -->
  <link rel="preload" href="/style.css?v=11" as="style">
  <link rel="stylesheet" href="/style.css?v=11">
</head>
<body>
  <header class="topbar">
    <img src="/assets/logo-lyn.png" alt="LYN AutoSales" class="logo">
    <div class="brand">LYN AutoSales — Evaluador <span class="sub">Tony Dev</span></div>
  </header>

  <main>
    <!-- Home -->
    <section id="v-home" class="view active">
      <div id="empty" class="empty">
        Aún no hay vehículos<br><small>Toca “+ Nuevo” para crear el primero.</small>
      </div>
      <div id="veh-grid" class="grid"></div>
    </section>

    <!-- Vehículo -->
    <section id="v-veh" class="view">
      <h3>Ficha del vehículo</h3>
      <div class="form grid2">
        <!-- En la ficha de vehículo -->
          <div class="kv">
            <label>Vehículo ID</label>
            <div id="vehIdView" class="pill mono">Se asignará al guardar</div>
            <input type="hidden" id="vehId"><!-- oculto: para updates -->
          </div>
        <label>Fecha<input id="fecha" type="date"></label>
        <label>VIN (17)<input id="vin" maxlength="17" placeholder="1HG..."></label>
        <label>Marca<input id="marca"></label>
        <label>Modelo<input id="modelo"></label>
        <label>Año<input id="anio"></label>
        <label>Color<input id="color"></label>
        <label>País<input id="pais"></label>
        <label class="file">Foto del vehículo
          <input id="vehPhoto" type="file" accept="image/*" capture="environment">
        </label>
        <div id="vehPhotoThumb"></div>
        <label class="notes">Notas<textarea id="notas"></textarea></label>
      </div>
      <div class="row">
        <button class="btn" onclick="go('home')">← Inicio</button>
        <button class="btn" onclick="decodeVIN()">Decodificar VIN</button>
        <button class="btn primary" onclick="saveVehicle()">Guardar</button>
      </div>
    </section>
    <!-- Reporte -->
    <section id="v-report" class="view">
      <h3>Reporte</h3>
      <div class="card">
        <div><b>ID:</b> <span id="p_vehId">—</span></div>
        <div><b>Fecha:</b> <span id="p_fecha">—</span></div>
        <div><b>VIN:</b> <span id="p_vin">—</span></div>
        <div><b>Marca:</b> <span id="p_marca">—</span> &nbsp; 
             <b>Modelo:</b> <span id="p_modelo">—</span> &nbsp; 
             <b>Año:</b> <span id="p_anio">—</span></div>
        <div><b>Color:</b> <span id="p_color">—</span> &nbsp; 
             <b>País:</b> <span id="p_pais">—</span></div>
        <div><b>Notas:</b> <span id="p_notas">—</span></div>
        <div class="row">
          <span class="pill">Severidad: <b id="p_sevGlobal">—</b></span>
          <span class="pill money" id="p_total">$0</span>
        </div>
      </div>
      <div id="p_listado"></div>
      <div class="row">
        <button class="btn" onclick="go('home')">← Inicio</button>
        <button class="btn primary" onclick="exportPDF()">Exportar PDF</button>
      </div>
    </section>

    <!-- Panel de daño -->
    <aside id="dmgSheet" class="sheet">
      <div class="sheet-card">
        <div class="sheet-head">
          Detalle de daño <button class="btn" onclick="closeSheet()">×</button>
        </div>
        <div class="grid2">
          <label>Parte<select id="d_parte"></select></label>
          <label>Ubicación<input id="d_ubic" placeholder="Esquina, zona, etc."></label>
          <label>Severidad<select id="d_sev"><option>Bajo</option><option>Medio</option><option>Alto</option></select></label>
          <label>Descripción<textarea id="d_descr"></textarea></label>
          <label>Costo (USD)<input id="d_cost" type="number" min="0" step="1" value="0"></label>
          <label class="file">Fotos (thumb+full)
            <input id="d_fotos" type="file" accept="image/*" multiple>
          </label>
          <div id="d_thumbs" class="thumbs"></div>
        </div>
        <div class="row">
          <button id="dmgDelete" class="btn danger">Eliminar</button>
          <button id="dmgSave" class="btn primary">Guardar</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- ===== Modal Daños ===== -->
<div id="damageModal" class="modal hidden" aria-hidden="true">
  <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="dmgTitle">
    <header class="modal__header">
      <div class="modal__title">
        <svg xmlns="http://www.w3.org/2000/svg" class="modal__logo" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.11-.62l-1.92-3.32c-.12-.21-.38-.3-.61-.22l-2.39.96a7.007 7.007 0 00-1.63-.94l-.36-2.54A.486.486 0 0014.4 2h-4.8c-.24 0-.45.17-.48.41l-.36 2.54c-.6.23-1.15.54-1.63.94l-2.39-.96c-.23-.09-.49.01-.61.22L2.31 8.86c-.12.21-.07.48.11.62l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.42 14.5c-.18.14-.23.41-.11.62l1.92 3.32c.12.21.38.3.61.22l2.39-.96c.48.4 1.03.72 1.63.94l.36 2.54c.03.24.24.41.48.41h4.8c.24 0 .45-.17.48-.41l.36-2.54c.6-.23 1.15-.54 1.63-.94l2.39.96c.23.09.49-.01.61-.22l1.92-3.32c.12-.21.07-.48-.11-.62l-2.03-1.58zM12 15.6c-1.99 0-3.6-1.61-3.6-3.6s1.61-3.6 3.6-3.6 3.6 1.61 3.6 3.6-1.61 3.6-3.6 3.6z"/>
        </svg>
        <h3 id="dmgTitle">Daños —</h3>
      </div>
      <div class="modal__actions">
        <button class="btn sm" id="dmgNewBtn">+ Nuevo</button>
        <button class="btn sm ghost" id="dmgCloseBtn" aria-label="Cerrar">✕</button>
      </div>
    </header>

    <!-- barra totales/opciones -->
    <div class="rep-controls">
      <div class="rep-summary">
        <span id="dmgCount">0 daños</span>
        <span id="dmgSum" class="pill money">$0</span>
      </div>
    </div>

    <div id="dmgModalList" class="list"></div>
  </div>
</div>
  <!-- ===== Modal Reparación ===== -->
<div id="repairModal" class="modal hidden" aria-hidden="true">
  <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="repTitle">
    <header class="modal__header">
      <div class="modal__title">
        <svg xmlns="http://www.w3.org/2000/svg" class="modal__logo" viewBox="0 0 24 24" fill="currentColor">
          <path d="M2 21h4v-2H4v-2h2v-2H4v-2h2V9H2V7h6v14H2v-2zm20-9.5c0-3.86-3.14-7-7-7-1.38 0-2.66.41-3.73 1.12l1.42 1.42c.67-.44 1.47-.7 2.31-.7 2.48 0 4.5 2.02 4.5 4.5S17.48 15.5 15 15.5c-.84 0-1.64-.26-2.31-.7l-1.42 1.42A6.97 6.97 0 0015 17c3.86 0 7-3.14 7-7.5zM11.29 8.71L5 15l1.41 1.41L12.7 10.1l-1.41-1.39z"/>
        </svg>
        <h3 id="repTitle">Reparación —</h3>
      </div>
      <div class="modal__actions">
        <button id="btnSharePending" class="btn sm">Compartir pendientes</button>
        <button class="btn sm ghost" id="repCloseBtn" aria-label="Cerrar">✕</button>
      </div>
    </header>

    <div class="rep-controls">
      <div class="segmented">
        <button id="repFilterAll"  class="seg on">Todos</button>
        <button id="repFilterPend" class="seg">Pendientes</button>
        <button id="repFilterDone" class="seg">Listos</button>
      </div>
      <div class="rep-summary">
        <span id="repCount">0 daños</span>
        <span id="repPendingSum" class="pill money">$0</span>
      </div>
    </div>

    <div id="repList" class="list"></div>
  </div>
</div>
  
  <!-- FAB: crear vehículo -->
<!-- FAB: crear vehículo -->
<button id="fabNew" class="fab" type="button" onclick="window.newVehicle && window.newVehicle()">+ Nuevo</button>
  <!-- Carga principal de JS (sin type=module) -->
<script src="/app.js?v=14" defer></script>

<!-- Loader de respaldo si app.js no se ejecuta por cache/errores -->
<script>
(function(){
  // Si en 900 ms no se marcó como cargado, forzamos recarga de app.js con cache-buster
  setTimeout(function(){
    if (!window.__lyn_loaded) {
      var s = document.createElement('script');
      s.src = '/app.js?v=' + Date.now();
      document.body.appendChild(s);
    }
  }, 900);
})();
</script>
</body>
</html>
