<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>LYN AutoSales — Evaluador</title>
  <link rel="apple-touch-icon" href="/assets/logo-lyn.png">
  <!-- CSS mínimo de respaldo -->
  <style>
    body {background:#0b0f14;color:#e9f1f7;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .view{display:none}.view.active{display:block}
  </style>
  <!-- CSS externo con cache-buster -->
  <link rel="preload" href="/style.css?v=11" as="style">
  <link rel="stylesheet" href="/style.css?v=11">
</head>
<body>
  <header class="topbar">
    <img src="/assets/logo-lyn.png" alt="LYN AutoSales" class="logo">
    <div class="brand">LYN AutoSales — Evaluador <span class="sub">Tony Dev</span></div>
  </header>

  <main>
    <!-- Home -->
    <section id="v-home" class="view active">
      <div id="empty" class="empty">
        Aún no hay vehículos<br><small>Toca “+ Nuevo” para crear el primero.</small>
      </div>
      <div id="veh-grid" class="grid"></div>
    </section>

    <!-- Vehículo -->
    <section id="v-veh" class="view">
      <h3>Ficha del vehículo</h3>
      <div class="form grid2">
        <!-- En la ficha de vehículo -->
          <div class="kv">
            <label>Vehículo ID</label>
            <div id="vehIdView" class="pill mono">Se asignará al guardar</div>
            <input type="hidden" id="vehId"><!-- oculto: para updates -->
          </div>
        <label>Fecha<input id="fecha" type="date"></label>
        <label>VIN (17)<input id="vin" maxlength="17" placeholder="1HG..."></label>
        <label>Marca<input id="marca"></label>
        <label>Modelo<input id="modelo"></label>
        <label>Año<input id="anio"></label>
        <label>Color<input id="color"></label>
        <label>País<input id="pais"></label>
        <label class="file">Foto del vehículo
          <input id="vehPhoto" type="file" accept="image/*" capture="environment">
        </label>
        <div id="vehPhotoThumb"></div>
        <label class="notes">Notas<textarea id="notas"></textarea></label>
      </div>
      <div class="row">
        <button class="btn" onclick="go('home')">← Inicio</button>
        <button class="btn" onclick="decodeVIN()">Decodificar VIN</button>
        <button class="btn primary" onclick="saveVehicle()">Guardar</button>
      </div>
    </section>
    <!-- Reporte -->
    <section id="v-report" class="view">
      <h3>Reporte</h3>
      <div class="card">
        <div><b>ID:</b> <span id="p_vehId">—</span></div>
        <div><b>Fecha:</b> <span id="p_fecha">—</span></div>
        <div><b>VIN:</b> <span id="p_vin">—</span></div>
        <div><b>Marca:</b> <span id="p_marca">—</span> &nbsp; 
             <b>Modelo:</b> <span id="p_modelo">—</span> &nbsp; 
             <b>Año:</b> <span id="p_anio">—</span></div>
        <div><b>Color:</b> <span id="p_color">—</span> &nbsp; 
             <b>País:</b> <span id="p_pais">—</span></div>
        <div><b>Notas:</b> <span id="p_notas">—</span></div>
        <div class="row">
          <span class="pill">Severidad: <b id="p_sevGlobal">—</b></span>
          <span class="pill money" id="p_total">$0</span>
        </div>
      </div>
      <div id="p_listado"></div>
      <div class="row">
        <button class="btn" onclick="go('home')">← Inicio</button>
        <button class="btn primary" onclick="exportPDF()">Exportar PDF</button>
      </div>
    </section>

    <!-- Panel de daño -->
    <aside id="dmgSheet" class="sheet">
      <div class="sheet-card">
        <div class="sheet-head">
          Detalle de daño <button class="btn" onclick="closeSheet()">×</button>
        </div>
        <div class="grid2">
          <label>Parte<select id="d_parte"></select></label>
          <label>Ubicación<input id="d_ubic" placeholder="Esquina, zona, etc."></label>
          <label>Severidad<select id="d_sev"><option>Bajo</option><option>Medio</option><option>Alto</option></select></label>
          <label>Descripción<textarea id="d_descr"></textarea></label>
          <label>Costo (USD)<input id="d_cost" type="number" min="0" step="1" value="0"></label>
          <label class="file">Fotos (thumb+full)
            <input id="d_fotos" type="file" accept="image/*" multiple>
          </label>
          <div id="d_thumbs" class="thumbs"></div>
        </div>
        <div class="row">
          <button id="dmgDelete" class="btn danger">Eliminar</button>
          <button id="dmgSave" class="btn primary">Guardar</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- ===== Modal Daños ===== -->
<div id="damageModal" class="modal hidden" aria-hidden="true">
  <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="dmgTitle">
    <header class="modal__header">
      <div class="modal__title">
        <svg xmlns="http://www.w3.org/2000/svg" class="modal__logo" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.11-.62l-1.92-3.32c-.12-.21-.38-.3-.61-.22l-2.39.96a7.007 7.007 0 00-1.63-.94l-.36-2.54A.486.486 0 0014.4 2h-4.8c-.24 0-.45.17-.48.41l-.36 2.54c-.6.23-1.15.54-1.63.94l-2.39-.96c-.23-.09-.49.01-.61.22L2.31 8.86c-.12.21-.07.48.11.62l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L2.42 14.5c-.18.14-.23.41-.11.62l1.92 3.32c.12.21.38.3.61.22l2.39-.96c.48.4 1.03.72 1.63.94l.36 2.54c.03.24.24.41.48.41h4.8c.24 0 .45-.17.48-.41l.36-2.54c.6-.23 1.15-.54 1.63-.94l2.39.96c.23.09.49-.01.61-.22l1.92-3.32c.12-.21.07-.48-.11-.62l-2.03-1.58zM12 15.6c-1.99 0-3.6-1.61-3.6-3.6s1.61-3.6 3.6-3.6 3.6 1.61 3.6 3.6-1.61 3.6-3.6 3.6z"/>
        </svg>
        <h3 id="dmgTitle">Daños —</h3>
      </div>
      <div class="modal__actions">
        <button class="btn sm" id="dmgNewBtn">+ Nuevo</button>
        <button class="btn sm ghost" id="dmgCloseBtn" aria-label="Cerrar">✕</button>
      </div>
    </header>

    <!-- barra totales/opciones -->
    <div class="rep-controls">
      <div class="rep-summary">
        <span id="dmgCount">0 daños</span>
        <span id="dmgSum" class="pill money">$0</span>
      </div>
    </div>

    <div id="dmgModalList" class="list"></div>
  </div>
</div>
  <!-- ===== Modal Reparación ===== -->
<div id="repairModal" class="modal hidden" aria-hidden="true">
  <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="repTitle">
    <header class="modal__header">
      <div class="modal__title">
        <svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" class="modal__logo" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 width="800px" height="800px" viewBox="0 0 512 512"  xml:space="preserve">
<style type="text/css">
<![CDATA[
	.st0{fill:#facc15;}
]]>
</style>
<g>
	<path class="st0" d="M360.102,240.012l10.156-10.266c0,0,15.609-13.406,33.406-7.328c30.984,10.578,66.781-0.875,91.609-25.734
		c7.063-7.063,15.641-21.234,15.641-21.234c0.984-1.344,1.328-3.047,0.922-4.672l-1.922-7.906c-0.359-1.484-1.313-2.75-2.625-3.531
		c-1.313-0.766-2.891-0.969-4.344-0.547l-60.984,16.969c-2.266,0.625-4.688-0.219-6.063-2.109l-28.015-38.594
		c-0.859-1.172-1.219-2.641-1.016-4.063l5.641-41c0.297-2.234,1.891-4.047,4.063-4.656l64.406-17.922
		c2.906-0.813,4.672-3.813,3.953-6.766l-2.547-10.359c-0.344-1.469-1.281-2.719-2.563-3.5c0,0-5.047-3.344-8.719-5.234
		c-36.578-18.891-82.64-13.031-113.312,17.656c-22.656,22.656-31.531,53.688-27.375,83.156c3.203,22.656,1.703,34.703-8.078,45.047
		c-0.891,0.922-3.703,3.734-8.047,8L360.102,240.012z"/>
	<path class="st0" d="M211.383,295.418C143.024,361.652,68.461,433.715,68.461,433.715c-2.547,2.438-4,5.797-4.047,9.313
		c-0.047,3.5,1.344,6.891,3.813,9.375l31.938,31.938c2.5,2.484,5.875,3.859,9.391,3.813c3.516-0.031,6.859-1.5,9.281-4.031
		l139.328-140.953L211.383,295.418z"/>
	<path class="st0" d="M501.43,451.371c2.484-2.484,3.859-5.859,3.813-9.375c-0.031-3.516-1.5-6.859-4.031-9.297L227.415,166.246
		l-43.953,43.969L450.805,483.09c2.438,2.547,5.781,4,9.297,4.047s6.891-1.344,9.391-3.828L501.43,451.371z"/>
	<path class="st0" d="M254.196,32.621c-32.969-12.859-86.281-14.719-117.156,16.141c-24.313,24.313-59.875,59.891-59.875,59.891
		c-12.672,12.656-0.906,25.219-10.266,34.563c-9.359,9.359-24.313,0-32.734,8.422L3.29,182.527c-4.391,4.375-4.391,11.5,0,15.891
		l43.016,43.016c4.391,4.391,11.516,4.391,15.906,0l30.875-30.875c8.438-8.422-0.938-23.375,8.438-32.719
		c12.609-12.625,26.375-10.484,34.328-2.547l15.891,15.891l17.219,4.531l43.953-43.953l-5.063-16.688
		c-14.016-14.031-16.016-30.266-7.234-39.047c13.594-13.594,36.047-33.234,57.078-41.656
		C271.102,49.012,267.055,35.668,254.196,32.621z M194.571,103.48c-0.063,0.047,5.859-7.281,5.969-7.375L194.571,103.48z"/>
</g>
</svg>
        <h3 id="repTitle">Reparación —</h3>
      </div>
      <div class="modal__actions">
        <button id="btnSharePending" class="btn sm">Compartir pendientes</button>
        <button class="btn sm ghost" id="repCloseBtn" aria-label="Cerrar">✕</button>
      </div>
    </header>

    <div class="rep-controls">
      <div class="segmented">
        <button id="repFilterAll"  class="seg on">Todos</button>
        <button id="repFilterPend" class="seg">Pendientes</button>
        <button id="repFilterDone" class="seg">Listos</button>
      </div>
      <div class="rep-summary">
        <span id="repCount">0 daños</span>
        <span id="repPendingSum" class="pill money">$0</span>
      </div>
    </div>

    <div id="repList" class="list"></div>
  </div>
</div>
  
  <!-- FAB: crear vehículo -->
<!-- FAB: crear vehículo -->
<button id="fabNew" class="fab" type="button" onclick="window.newVehicle && window.newVehicle()">+ Nuevo</button>
  <!-- Carga principal de JS (sin type=module) -->
<script src="/app.js?v=14" defer></script>

<!-- Loader de respaldo si app.js no se ejecuta por cache/errores -->
<script>
(function(){
  // Si en 900 ms no se marcó como cargado, forzamos recarga de app.js con cache-buster
  setTimeout(function(){
    if (!window.__lyn_loaded) {
      var s = document.createElement('script');
      s.src = '/app.js?v=' + Date.now();
      document.body.appendChild(s);
    }
  }, 900);
})();
</script>
</body>
</html>
